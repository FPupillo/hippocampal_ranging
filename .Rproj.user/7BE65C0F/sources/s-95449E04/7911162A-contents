# clearing the environment
rm(list = ls())
# getting the neccessary libs
library(irr)
library(ggplot2)
#library(readxl)

# function to calculate the kappa
KappaCalc<-function(test.set, correct){
# calculating kappas of interest
StartLeftKappa <- kappa2(cbind(test.set$Starting.slice.left,correct$Starting.slice.left))
StartRightKappa <-kappa2(cbind(test.set$Starting.slice.right,correct$Starting.slice.right))
EndLeftKappa <-kappa2(cbind(test.set$end.slice.left,correct$end.slice.left))
EndRightKappa <-kappa2(cbind(test.set$end.slice.right,correct$end.slice.right))

# writing these in a vector
AllKappas <- cbind(StartLeftKappa$value,StartRightKappa$value,EndLeftKappa$value,EndRightKappa$value)

return(AllKappas)
}

# set working directory 
setwd("/home/francesco/PowerFolders/Frankfurt_University/fMRI/hippocampus_segmentation")
# loading data
test.set1<-read.csv("test_set1.csv")
correct1<- read.csv("Correct-slices1.csv")
Kappa1<-KappaCalc(test.set1, correct1)

test.set2 <- read.csv("test_set2.csv")
correct2<- read.csv("Correct-slices2.csv")

# delete 127_2 in the test set
test.set2<-test.set2[ test.set2$ID!="127_2",]

Kappa2<-KappaCalc(test.set2, correct2)

# third
test.set3 <- read.csv("test_set3.csv")
correct3<- read.csv("Correct-slices3.csv")


Kappa3<-KappaCalc(test.set3, correct3)

# now the fourth
test.set4 <- read.csv("test_set4.csv")
correct4<- read.csv("Correct-slices4.csv")
names(test.set4)<-names(correct4)


Kappa4<-KappaCalc(test.set4, correct4)

# bind the kappa
kappaAll<-data.frame(rbind(Kappa1, Kappa2, Kappa3, Kappa4))

names(kappaAll)<-c("start.left", "start.right", "end.left", "end.right")

# create test set variable
kappaAll$testset<-as.factor(1:nrow(kappaAll))

# merge
kappamer<-melt(kappaAll, id.vars="testset")

# plot
ggplot(kappamer, aes(x=testset, y=value, group = variable, colour=variable))+
  geom_line()+
  geom_point()+
  geom_text(aes(label = round(value, 2)),
            vjust = "outward", hjust = "inward",
            show.legend = FALSE, colour = "black") 



# second round of practice
# loading data
test.set1_2 <- read.csv("test_set1-2.csv")
kappa5<-KappaCalc(test.set1_2, correct1)

test.set_2_2<-read.csv("test_set2-2.csv")

kappa6<-KappaCalc(test.set_2_2, correct2)
